<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tank Controls Demo</title>
<style>
* {
  user-select: none;
  -webkit-user-select: none;
  -ms-user-select: none;
  -moz-user-select: none;
  -webkit-touch-callout: none;
}

button {
  -webkit-tap-highlight-color: transparent;
}

body {
  display:flex;
  justify-content:space-around;
  align-items:center;
  height:100vh;
  margin:0;
  font-family:Arial;
}
.controls { display:flex; flex-direction:column; align-items:center; }
.row { display:flex; justify-content:center; margin:5px; }
button {
  width:80px; height:80px; font-size:24px; margin:5px; border-radius:12px;
  transition: transform 0.1s, background-color 0.2s;
}
button:active { transform: scale(0.85); }
button.hold { background-color: #ccc; }

#shoot {
  background:red; color:white; width:70px; height:70px; font-size:24px; border-radius:50%; margin-bottom:5px; position:relative;
}

#shootOverlay {
  position:absolute; top:0; left:0; width:70px; height:70px; border-radius:50%;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  background:rgba(0,0,0,0.5); color:white; font-size:12px; display:none;
}

#reloadCircle { width:50px; height:50px; transform: rotate(-90deg); }
#reloadCircle svg { width:100%; height:100%; }
#reloadCircle circle { fill:none; stroke:rgba(255,255,255,0.3); stroke-width:5; }
#reloadCircle circle.progress { stroke:white; stroke-dasharray: 157; stroke-dashoffset: 157; transition:none; }

#turretControls { display:flex; flex-direction:column; align-items:center; margin-top:5px; }
#turretLabel { font-size:14px; margin-top:2px; }

#ammoSelect { margin-top:10px; font-size:16px; padding:4px; }
</style>
</head>
<body>
<div class="controls">
  <button id="up">&#8593;</button>
  <button id="down">&#8595;</button>
</div>

<div class="controls" style="position:relative;">
  <div style="position:relative;">
    <button id="shoot">💥</button>
    <div id="shootOverlay">
      <div>Přebíjení</div>
      <div id="reloadCircle">
        <svg>
          <circle cx="25" cy="25" r="25"></circle>
          <circle class="progress" cx="25" cy="25" r="25"></circle>
        </svg>
      </div>
    </div>
  </div>
  <div class="row">
    <button id="left">&#8592;</button>
    <button id="right">&#8594;</button>
  </div>

  <div id="turretControls">
    <div id="turretLabel">Pohyb věže</div>
    <div id="turretButtons" class="row">
      <button id="turretLeft">&#8634;&#8592;</button>
      <button id="turretRight">&#8594;</button>
    </div>
    <select id="ammoSelect">
      <option value="heat">HEAT 🔥</option>
      <option value="explosive">Explozivní 💥</option>
      <option value="piercing">Průbojná ⚡</option>
      <option value="sabot">Sabot 🎯</option>
    </select>
  </div>
</div>

<script>
let sounds = {};
let soundsReady = false;

// Inicializace zvuků při prvním tapu (nutné pro iPhone Safari)
function initSounds() {
  if (soundsReady) return;
  sounds = {
    shoot: new Audio("https://fchuda24-hash.github.io/tank_games/shoot.mp3"),
    reload: new Audio("https://fchuda24-hash.github.io/tank_games/reload.mp3"),
    engine_idle: new Audio("https://fchuda24-hash.github.io/tank_games/engine_idle.mp3"),
    engine_move: new Audio("https://fchuda24-hash.github.io/tank_games/engine_move.mp3"),
    call_heat: new Audio("https://fchuda24-hash.github.io/tank_games/call_heat.mp3"),
    call_explosive: new Audio("https://fchuda24-hash.github.io/tank_games/call_explosive.mp3"),
    call_piercing: new Audio("https://fchuda24-hash.github.io/tank_games/call_piercing.mp3"),
    call_sabot: new Audio("https://fchuda24-hash.github.io/tank_games/call_sabot.mp3"),
    ready_heat: new Audio("https://fchuda24-hash.github.io/tank_games/ready_heat.mp3"),
    ready_explosive: new Audio("https://fchuda24-hash.github.io/tank_games/ready_explosive.mp3"),
    ready_sabot: new Audio("https://fchuda24-hash.github.io/tank_games/ready_sabot.mp3"),
  };

  // loop pro určité zvuky
  sounds.engine_idle.loop = true;
  sounds.engine_move.loop = true;
  sounds.reload.loop = true;

  soundsReady = true;
  console.log("Sounds initialized ✅");
}
document.body.addEventListener("click", () => {
  if (!soundsReady) initSounds();
}, { once:true });

// Ovládání pohybu
const buttons = ['up','down','left','right'];
buttons.forEach(id => {
  const btn = document.getElementById(id);
  btn.addEventListener('click', () => {
    console.log('Command:', id);
    if (soundsReady) {
      if (id === 'up' || id === 'down') {
        sounds.engine_idle.pause();
        sounds.engine_move.currentTime = 0;
        sounds.engine_move.play();
      }
    }
  });
  btn.addEventListener('pointerdown', () => btn.classList.add('hold'));
  btn.addEventListener('pointerup', () => {
    btn.classList.remove('hold');
    if (soundsReady && (id === 'up' || id === 'down')) {
      sounds.engine_move.pause();
      sounds.engine_idle.currentTime = 0;
      sounds.engine_idle.play();
    }
  });
  btn.addEventListener('pointerleave', () => btn.classList.remove('hold'));
});

// Střelba a přebíjení
const shoot = document.getElementById('shoot');
const overlay = document.getElementById('shootOverlay');
const progressCircle = document.querySelector('#reloadCircle circle.progress');
let canShoot = true;
let ammoType = 'explosive';
const ammoSettings = {
  heat: { emoji:'🔥', cooldown:5000, call:'call_heat', ready:'ready_heat' },
  explosive: { emoji:'💥', cooldown:7000, call:'call_explosive', ready:'ready_explosive' },
  piercing: { emoji:'⚡', cooldown:10000, call:'call_piercing', ready:null },
  sabot: { emoji:'🎯', cooldown:8000, call:'call_sabot', ready:'ready_sabot' }
};

function startCooldown(duration, callSound, readySound){
  canShoot = false;
  overlay.style.display = "flex";
  const totalDash = 157;
  const startTime = performance.now();

  if (soundsReady) {
    if (callSound && sounds[callSound]) sounds[callSound].play();
    sounds.reload.currentTime = 0;
    sounds.reload.play();
  }

  function update(time) {
    let elapsed = time - startTime;
    let progress = Math.min(elapsed / duration, 1);
    progressCircle.style.strokeDashoffset = totalDash * (1 - progress);
    if(progress < 1){
      requestAnimationFrame(update);
    }
  }
  requestAnimationFrame(update);

  setTimeout(() => {
    overlay.style.display = "none";
    progressCircle.style.strokeDashoffset = totalDash;
    canShoot = true;
    if (soundsReady) {
      sounds.reload.pause();
      if (readySound && sounds[readySound]) sounds[readySound].play();
    }
  }, duration);
}

shoot.addEventListener('click', () => {
  if(!canShoot || !soundsReady) return;
  console.log('Command: shoot', ammoType);
  sounds.shoot.currentTime = 0;
  sounds.shoot.play();
  startCooldown(ammoSettings[ammoType].cooldown, ammoSettings[ammoType].call, ammoSettings[ammoType].ready);
});

// Ammo výběr
const ammoSelect = document.getElementById('ammoSelect');
ammoSelect.addEventListener('change', e => {
  ammoType = e.target.value;
  shoot.textContent = ammoSettings[ammoType].emoji;
  startCooldown(ammoSettings[ammoType].cooldown, ammoSettings[ammoType].call, ammoSettings[ammoType].ready);
});

// Ovládání věže
const turretButtons = ['turretLeft','turretRight'];
turretButtons.forEach(id => {
  const btn = document.getElementById(id);
  btn.addEventListener('click', () => console.log('Turret:', id));
  btn.addEventListener('pointerdown', () => btn.classList.add('hold'));
  btn.addEventListener('pointerup', () => btn.classList.remove('hold'));
  btn.addEventListener('pointerleave', () => btn.classList.remove('hold'));
});
</script>
</body>
</html>
